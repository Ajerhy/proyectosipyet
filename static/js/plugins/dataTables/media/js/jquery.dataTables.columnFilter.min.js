/*
* File:        jquery.dataTables.columnFilter.js
* Version:     1.5.6.
* Author:      Jovan Popovic 
*/
(function(e){e.fn.columnFilter=function(t){function c(e,t,n,r,i){if(typeof t=="undefined")return new Array;if(typeof n=="undefined")n=true;if(typeof r=="undefined")r=true;if(typeof i=="undefined")i=true;var s;if(r==true)s=e.aiDisplay;else s=e.aiDisplayMaster;var o=new Array;for(var u=0,a=s.length;u<a;u++){var f=s[u];var l=S.fnGetData(f);var c=l[t];if(i==true&&c.length==0)continue;else if(n==true&&jQuery.inArray(c,o)>-1)continue;else o.push(c)}return o.sort()}function h(e){if(T.bUseColVis)return e;else return S.fnSettings().oApi._fnVisibleToColumnIndex(S.fnSettings(),e)}function p(t,o,u,a,f,c){var p="text_filter form-control";if(a)p="number_filter form-control";i=i.replace(/(^\s*)|(\s*$)/g,"");var d=t.fnSettings().aoPreSearchCols[r].sSearch;var v="search_init ";var m=i;if(d!=""&&d!="^"){if(a&&d.charAt(0)=="^")m=d.substr(1);else m=d;v=""}var g=e('<input type="text" class="'+v+p+'" value="'+m+'" rel="'+r+'"/>');if(c!=undefined&&c!=-1){g.attr("maxlength",c)}s.html(g);if(a)s.wrapInner('<span class="filter_column filter_number" />');else s.wrapInner('<span class="filter_column filter_text" />');n[r]=i;var y=r;if(a&&!t.fnSettings().oFeatures.bServerSide){g.keyup(function(){t.fnFilter("^"+this.value,h(y),true,false);l()})}else{g.keyup(function(){if(t.fnSettings().oFeatures.bServerSide&&f!=0){var n=t.fnSettings().aoPreSearchCols[y].sSearch;var r=e(this).data("dt-iLastFilterLength");if(typeof r=="undefined")r=0;var i=this.value.length;if(Math.abs(i-r)<f){return}else{e(this).data("dt-iLastFilterLength",i)}}t.fnFilter(this.value,h(y),o,u);l()})}g.focus(function(){if(e(this).hasClass("search_init")){e(this).removeClass("search_init");this.value=""}});g.blur(function(){if(this.value==""){e(this).addClass("search_init");this.value=n[y]}})}function d(t){s.html(E(0));var n=t.attr("id")+"_range_from_"+r;var i=e('<input type="text" class="number_range_filter form-control" id="'+n+'" rel="'+r+'"/>');s.append(i);s.append(E(1));var o=t.attr("id")+"_range_to_"+r;var u=e('<input type="text" class="number_range_filter form-control" id="'+o+'" rel="'+r+'"/>');s.append(u);s.append(E(2));s.wrapInner('<span class="filter_column filter_number_range form-control" />');var f=r;a.push(r);t.dataTableExt.afnFiltering.push(function(e,r,i){if(t.attr("id")!=e.sTableId)return true;if(document.getElementById(n)==null)return true;var s=document.getElementById(n).value*1;var u=document.getElementById(o).value*1;var a=r[h(f)]=="-"?0:r[h(f)]*1;if(s==""&&u==""){return true}else if(s==""&&a<=u){return true}else if(s<=a&&""==u){return true}else if(s<=a&&a<=u){return true}return false});e("#"+n+",#"+o,s).keyup(function(){var e=document.getElementById(n).value*1;var r=document.getElementById(o).value*1;if(e!=0&&r!=0&&e>r)return;t.fnDraw();l()})}function v(t){var n=o.split(/[}{]/);s.html("");var i=t.attr("id")+"_range_from_"+r;var u=e('<input type="text" class="date_range_filter form-control" id="'+i+'" rel="'+r+'"/>');u.datepicker();var f=t.attr("id")+"_range_to_"+r;var c=e('<input type="text" class="date_range_filter form-control" id="'+f+'" rel="'+r+'"/>');for(ti=0;ti<n.length;ti++){if(n[ti]==T.sDateFromToken){s.append(u)}else{if(n[ti]==T.sDateToToken){s.append(c)}else{s.append(n[ti])}}}s.wrapInner('<span class="filter_column filter_date_range" />');c.datepicker();var p=r;a.push(r);t.dataTableExt.afnFiltering.push(function(n,r,i){if(t.attr("id")!=n.sTableId)return true;var s=u.datepicker("getDate");var o=c.datepicker("getDate");if(s==null&&o==null){return true}var a=null;try{if(r[h(p)]==null||r[h(p)]=="")return false;a=e.datepicker.parseDate(e.datepicker.regional[""].dateFormat,r[h(p)])}catch(f){return false}if(a==null)return false;if(s==null&&a<=o){return true}else if(s<=a&&o==null){return true}else if(s<=a&&a<=o){return true}return false});e("#"+i+",#"+f,s).change(function(){t.fnDraw();l()})}function m(t,n,i,s,o,u,a,f){if(n==null)n=c(t.fnSettings(),i,true,false,true);var h=i;var p=t.fnSettings().aoPreSearchCols[r].sSearch;if(p==null||p=="")p=a;var d='<select class="search_init select_filter form-control" rel="'+r+'"><option value="" class="search_init">'+o+"</option>";if(f){d='<select class="search_init select_filter form-control" rel="'+r+'" multiple>'}var v=0;var m=n.length;for(v=0;v<m;v++){if(typeof n[v]!="object"){var g="";if(escape(n[v])==p||escape(n[v])==escape(p))g="selected ";d+="<option "+g+' value="'+escape(n[v])+'">'+n[v]+"</option>"}else{var g="";if(u){if(n[v].value==p)g="selected ";d+="<option "+g+'value="'+n[v].value+'">'+n[v].label+"</option>"}else{if(escape(n[v].value)==p)g="selected ";d+="<option "+g+'value="'+escape(n[v].value)+'">'+n[v].label+"</option>"}}}var b=e(d+"</select>");s.html(b);s.wrapInner('<span class="filter_column filter_select" />');if(f){b.change(function(){if(e(this).val()!=""){e(this).removeClass("search_init")}else{e(this).addClass("search_init")}var n=e(this).val();var r=[];if(n==null||n==[]){var i="^(.*)$"}else{e.each(n,function(e,t){r.push(y(t))});var i="^("+r.join("|")+")$"}t.fnFilter(i,h,true,false)})}else{b.change(function(){if(e(this).val()!=""){e(this).removeClass("search_init")}else{e(this).addClass("search_init")}if(u)t.fnFilter(e(this).val(),i,u);else t.fnFilter(unescape(e(this).val()),i);l()});if(p!=null&&p!="")t.fnFilter(unescape(p),i)}}function g(e,t,n,o,u){var a=e.fnSettings();if((t==null||typeof t=="function")&&a.sAjaxSource!=""&&!a.oFeatures.bServerSide){a.aoDrawCallback.push({fn:function(r,i,s){return function(a){if(a.iDraw==2&&a.sAjaxSource!=null&&a.sAjaxSource!=""&&!a.oFeatures.bServerSide){return m(e,t&&t(a.aoData,a),h(r),i,s,n,o,u)}}}(r,s,i),sName:"column_filter_"+r})}m(e,typeof t=="function"?null:t,h(r),s,i,n,o,u)}function y(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function b(t){var n=r;var o='<div class="dropdown select_filter form-control"><a class="dropdown-toggle" data-toggle="dropdown" href="#">'+i+'<b class="caret"></b></a><ul class="dropdown-menu" role="menu"><li data-value=""><a>Show All</a></li>',u,a=t.length;for(u=0;u<a;u++){o+='<li data-value="'+t[u]+'"><a>'+t[u]+"</a></li>"}var f=e(o+"</ul></div>");s.html(f);s.wrapInner('<span class="filterColumn filter_select" />');f.find("li").click(function(){S.fnFilter(e(this).data("value"),n)})}function w(t,n){if(n==null)n=c(t.fnSettings(),r,true,true,true);var o=r;var u="",a,f=n.length;var h=i.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("£","STERL").replace("@","AT").replace(/\s/g,"_");h=h.replace(/[^a-zA-Z 0-9]+/g,"");var p=i;if(T.sFilterButtonText!=null||T.sFilterButtonText!=undefined){p=T.sFilterButtonText}var d=10;var v=12;var m=Math.floor(f/v);if(f%v>0){m=m+1}var g=100/m-2;var y=d*m;if(m==1){g=20}var b='<div style="float:left; min-width: '+g+'%; " >';var w="</div>";var E=t.attr("id")+h;var S="chkBtnOpen"+E;var x=E+"-flt-toggle";u+='<button id="'+S+'" class="checkbox_filter btn btn-default" > '+p+"</button>";u+='<div id="'+x+'" '+'title="'+i+'" '+'rel="'+r+'" '+'class="toggle-check ui-widget-content ui-corner-all"  style="width: '+y+'%; " >';u+=b;for(a=0;a<f;a++){if(a%v==0&&a!=0){u+=w+b}var N=n[a];var C=n[a];if(typeof n[a]=="object"){N=n[a].label;C=n[a].value}u+='<input class="search_init checkbox_filter btn btn-default" type="checkbox" id= "'+E+"_cb_"+C+'" name= "'+h+'" value="'+C+'" >'+N+"<br/>";var k=e(u);s.html(k);s.wrapInner('<span class="filter_column filter_checkbox" />');k.change(function(){var n="";var r="|";var i=e('input:checkbox[name="'+h+'"]:checked').size();e('input:checkbox[name="'+h+'"]:checked').each(function(t){if(t==0&&i==1||t!=0&&t==i-1){r=""}n=n.replace(/^\s+|\s+$/g,"");n=n+e(this).val()+r;r="|"});if(n!=""){e('input:checkbox[name="'+h+'"]').removeClass("search_init")}else{e('input:checkbox[name="'+h+'"]').addClass("search_init")}t.fnFilter(n,o,true,false);l()})}e("#"+S).button();e("#"+x).dialog({autoOpen:false,hide:"blind",buttons:[{text:"Reset",click:function(){e('input:checkbox[name="'+h+'"]:checked').each(function(t){e(this).attr("checked",false);e(this).addClass("search_init")});t.fnFilter("",o,true,false);l();return false}},{text:"Close",click:function(){e(this).dialog("close")}}]});e("#"+S).click(function(){e("#"+x).dialog("open");var t=e(this);e("#"+x).dialog("widget").position({my:"top",at:"bottom",of:t});return false});var L=l;l=function(){var t=e("#"+S);e("#"+x).dialog("widget").position({my:"top",at:"bottom",of:t});L()}}function E(e){switch(e){case 0:return o.substring(0,o.indexOf("{from}"));case 1:return o.substring(o.indexOf("{from}")+6,o.indexOf("{to}"));default:return o.substring(o.indexOf("{to}")+4)}}var n,r,i,s;var o="From {from} to {to}";var u=new Array;var a=new Array;var f=null;var l=function(){};var S=this;var x={sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}",sDateFromToken:"from",sDateToToken:"to"};var T=e.extend(x,t);return this.each(function(){if(!S.fnSettings().oFeatures.bFilter)return;n=new Array;var t=S.fnSettings().aoFooter[0];var f=S.fnSettings().nTFoot;var l="tr";if(T.sPlaceHolder=="head:after"){var c=e("tr:first",S.fnSettings().nTHead).detach();if(S.fnSettings().bSortCellsTop){c.prependTo(e(S.fnSettings().nTHead));t=S.fnSettings().aoHeader[1]}else{c.appendTo(e(S.fnSettings().nTHead));t=S.fnSettings().aoHeader[0]}l="tr:last";f=S.fnSettings().nTHead}else if(T.sPlaceHolder=="head:before"){if(S.fnSettings().bSortCellsTop){var c=e("tr:first",S.fnSettings().nTHead).detach();c.appendTo(e(S.fnSettings().nTHead));t=S.fnSettings().aoHeader[1]}else{t=S.fnSettings().aoHeader[0]}l="tr:first";f=S.fnSettings().nTHead}e(t).each(function(t){r=t;var n={type:"text",bRegex:false,bSmart:true,iMaxLenght:-1,iFilterLength:0};if(T.aoColumns!=null){if(T.aoColumns.length<r||T.aoColumns[r]==null)return;n=T.aoColumns[r]}i=e(e(this)[0].cell).text();if(n.sSelector==null){s=e(e(this)[0].cell)}else{s=e(n.sSelector);if(s.length==0)s=e(e(this)[0].cell)}if(n!=null){if(n.sRangeFormat!=null)o=n.sRangeFormat;else o=T.sRangeFormat;switch(n.type){case"null":break;case"number":p(S,true,false,true,n.iFilterLength,n.iMaxLenght);break;case"select":if(n.bRegex!=true)n.bRegex=false;g(S,n.values,n.bRegex,n.selected,n.multiple);break;case"number-range":d(S);break;case"date-range":v(S);break;case"checkbox":w(S,n.values);break;case"twitter-dropdown":case"dropdown":b(n.values);break;case"text":default:bRegex=n.bRegex==null?false:n.bRegex;bSmart=n.bSmart==null?false:n.bSmart;p(S,bRegex,bSmart,false,n.iFilterLength,n.iMaxLenght);break}}});for(j=0;j<a.length;j++){var h=function(){var t=S.attr("id");return e("#"+t+"_range_from_"+a[j]).val()+T.sRangeSeparator+e("#"+t+"_range_to_"+a[j]).val()};u.push(h)}if(S.fnSettings().oFeatures.bServerSide){var m=S.fnSettings().fnServerData;S.fnSettings().fnServerData=function(t,n,r){for(j=0;j<a.length;j++){var i=a[j];for(k=0;k<n.length;k++){if(n[k].name=="sSearch_"+i)n[k].value=u[j]()}}n.push({name:"sRangeSeparator",value:T.sRangeSeparator});if(m!=null){try{m(t,n,r,S.fnSettings())}catch(s){m(t,n,r)}}else{e.getJSON(t,n,function(e){r(e)})}}}})}})(jQuery)